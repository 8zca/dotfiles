#!/bin/bash

set -e

root_dir=.

pkg_satisfy() {
  jq --exit-status "$1" < ${root_dir}/package.json >/dev/null
}

if [[ ! -d "${root_dir}/.git" ]]; then
  echo '---> Not Git repository'
  echo '---> Try to git init ...'
  git init
  git commit --allow-empty --message ':sunrise:'
fi

if [[ ! -f "${root_dir}/package.json" ]]; then
  echo '---> npm init ...'
  npm init --yes
fi

if ! git check-ignore --quiet 'node_modules'; then
  echo '---> Ignore node_modules ...'
  echo 'node_modules' >> .gitignore
fi

if ! pkg_satisfy '.devDependencies | has("typescript")'; then
  echo '---> Install TypeScript ...'
  npm install --save-dev typescript
fi

if [[ ! -f "${root_dir}/tsconfig.json" ]]; then
  echo '---> Create tsconfig.json ...'
  $(npm bin)/tsc --init
fi
